							PROCEDURE
							
					
1.简介

	我们常用的操作数据库语言SQL语句在执行的时候需要要先编译，然后执行，而存储过程
	
（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用

户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。




2.结构

	DELIMITER //
	
	CREATE PROCEDURE sp_name ([proc_parameter[,...]])  
        [characteristic ...] 
		routine_body 
	
	//	
	DELIMITER ;
	
	
	
	DELIMITER设置mysql结束符；
	
	sp_name参数是存储过程的名称；
	
	proc_parameter表示存储过程的参数列表； 
	
	characteristic参数指定存储过程的特性；
	
	routine_body参数是SQL代码的内容，可以用BEGIN…END来标志SQL代码的开始和结束。
	
	
(1)proc_parameter

	proc_parameter中的每个参数由3部分组成。这3部分分别是输入输出类型、参数名称和参数类型。其形式如下：

			[ IN | OUT | INOUT ] 	param_name 		type 
	
	IN表示输入参数，在存储过程中修改该参数的值不能被返回，
	
	OUT表示输出参数，在存储过程中修改该参数的值能返回
	
	INOUT表示既可以是输入，也可以是输出，与OUT相同
	
	param_name参数是存储过程的参数名称；
	
	type参数指定存储过程的参数类型，该类型可以是MySQL数据库的任意数据类型。
	
	
(2)characteristic

	characteristic参数有多个取值。其取值说明如下：

		LANGUAGE SQL：说明routine_body部分是由SQL语言的语句组成，这也是数据库系统默认的语言。
		
		[NOT] DETERMINISTIC：指明存储过程的执行结果是否是确定的。DETERMINISTIC表示结果是确定的。
		每次执行存储过程时，相同的输入会得到相同的输出。NOT DETERMINISTIC表示结果是非确定的，相
		同的输入可能得到不同的输出。默认情况下，结果是非确定的。

		{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }：指明子程序使用SQL语句的限制。
		CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；NO SQL表示子程序中不包含SQL语句；
		READS SQL DATA表示子程序中包含读数据的语句；MODIFIES SQL DATA表示子程序中包含写数据的语句。
		默认情况下，系统会指定为CONTAINS SQL。

		SQL SECURITY { DEFINER | INVOKER }：指明谁有权限来执行。DEFINER表示只有定义者自己才能够执行；
		INVOKER表示调用者可以执行。默认情况下，系统指定的权限是DEFINER。

		COMMENT 'string'：注释信息。


	
	
3.变量

	Ⅰ.变量定义（通常在过程中定义）

		DECLARE   variable_name   [,variable_name...]   datatype   [DEFAULT value];

		例如:DECLARE  abc  int  default 4000000;  

 
	Ⅱ.变量赋值
	
	
		SET  变量名 = 表达式值    [,variable_name = expression ...]
	
	
	Ⅲ.用户变量
	
	①用户变量名一般以@开头
	②滥用用户变量会导致程序难以理解及管理
		
		mysql > SELECT 'Hello World' INTO @x;  
		mysql > SELECT @x;  
		
		mysql > SET @y='Goodbye Cruel World';  
		mysql > SELECT @y; 
		
	IV.全局变量(常用的全局变量一般都是已经定义好的)
	
		mysql > SET @@y='Goodbye Cruel World';  
		mysql > SELECT @@y; 

4.存储过程管理

	DROP PROCEDURE sp_name								#删除sp_name存储过程
	
	SELECT name FROM MYSQL.PROC WHERE db='student';		#查看指定数据库的全部的存储过程

	SHOW PROCEDURE STATUS WHERE db='student';			#查看指定数据库的全部的存储过程
	
	SHOW CREATE PROCEDURE student.sp_name;				#查看指定数据库的存储过程创建过程
	
	
5.语句


----------------------------------条件----------------------------------

	Ⅰ. if-then -else语句
	
		mysql > DELIMITER //  
		mysql > CREATE PROCEDURE proc2(IN parameter int)  
				-> begin 
				-> declare var int;  
				-> set var=parameter+1;  
				-> if var=0 then 
				-> insert into t values(17);  
				-> end if;  
				-> if parameter=0 then 
				-> update t set s1=s1+1;  
				-> else 
				-> update t set s1=s1+2;  
				-> end if;  
				-> end;  
				-> //  
		mysql > DELIMITER ;  
		
	
	Ⅱ. case语句： 
		mysql > DELIMITER //  
		mysql > CREATE PROCEDURE proc3 (in parameter int)  
				-> begin 
				-> declare var int;  
				-> set var=parameter+1;  
				-> case var  
				-> when 0 then   
				-> insert into t values(17);  
				-> when 1 then   
				-> insert into t values(18);  
				-> else   
				-> insert into t values(19);  
				-> end case;  
				-> end;  
				-> //  
		mysql > DELIMITER ;
		
	
---------------------------------循环-----------------------------------
	
	Ⅰ. while ···· end while：
		
		mysql > DELIMITER //  
		mysql > CREATE PROCEDURE proc4()  
				-> begin 
				-> declare var int;  
				-> set var=0;  
				-> while var<6 do  
				-> insert into t values(var);  
				-> set var=var+1;  
				-> end while;  
				-> end;  
				-> //  
		mysql > DELIMITER ; 
		
		
	Ⅱ.repeat···· end repeat：
		它在执行操作后检查结果，而while则是执行前进行检查。
		
		mysql > DELIMITER //  
		mysql > CREATE PROCEDURE proc5 ()  
				-> begin   
				-> declare v int;  
				-> set v=0;  
				-> repeat  
				-> insert into t values(v);  
				-> set v=v+1;  
				-> until v>=5  
				-> end repeat;  
				-> end;  
				-> //  
		mysql > DELIMITER ;  
		
	
	Ⅲ. loop ·····end loop:
		loop循环不需要初始条件，这点和while 循环相似，同时和repeat循环一样不需要结束条件,
		leave语句的意义是离开循环。
		
		mysql > DELIMITER //  
		mysql > CREATE PROCEDURE proc6 ()  
				-> begin 
				-> declare v int;  
				-> set v=0;  
				-> LOOP_LABLE:loop  
				-> insert into t values(v);  
				-> set v=v+1;  
				-> if v >=5 then 
				-> leave LOOP_LABLE;  
				-> end if;  
				-> end loop;  
				-> end;  
				-> //  
		mysql > DELIMITER ;  